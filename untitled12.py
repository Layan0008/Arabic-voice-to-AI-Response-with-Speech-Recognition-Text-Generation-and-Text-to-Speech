# -*- coding: utf-8 -*-
"""Untitled12.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1xI18L1Od6Nx0U5REAjhlBWbzXHxtywNH
"""

!pip install cohere gTTS SpeechRecognition pydub

from google.colab import files
uploaded = files.upload()

import os
audio_file = list(uploaded.keys())[0]

import speech_recognition as sr
from pydub import AudioSegment

# Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ù„Ù Ø¨ØµÙŠØºØ© WAV
if not audio_file.endswith(".wav"):
    sound = AudioSegment.from_file(audio_file)
    wav_file = "converted_audio.wav"
    sound.export(wav_file, format="wav")
else:
    wav_file = audio_file

recognizer = sr.Recognizer()
with sr.AudioFile(wav_file) as source:
    audio_data = recognizer.record(source)
    try:
        text_input = recognizer.recognize_google(audio_data, language="ar")
        print("ğŸ”¹ Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬ Ù…Ù† Ø§Ù„ØµÙˆØª:", text_input)
    except sr.UnknownValueError:
        print("âŒ Ù„Ù… ÙŠØªÙ…ÙƒÙ† Ø§Ù„Ù†Ø¸Ø§Ù… Ù…Ù† ÙÙ‡Ù… Ø§Ù„ØµÙˆØª.")
        text_input = ""
    except sr.RequestError as e:
        print(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: {e}")
        text_input = ""

# ====== Ø§Ù„Ø®Ø·ÙˆØ© 2: ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø±Ø¯ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ù…ÙˆØ°Ø¬ ÙŠØ¯Ø¹Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ======
from transformers import pipeline

generator = pipeline("text-generation", model="aubmindlab/aragpt2-base")

prompt = f"Ø³Ø¤Ø§Ù„: {text_input}\nØ¬ÙˆØ§Ø¨:"
result = generator(prompt, max_new_tokens=100, do_sample=True, top_k=50, temperature=0.9)
generated_text = result[0]['generated_text'].split("Ø¬ÙˆØ§Ø¨:")[-1].strip()

print("ğŸ”¹ Ø§Ù„Ø±Ø¯ Ø§Ù„Ù†Ø§ØªØ¬:", generated_text)

# ====== Ø§Ù„Ø®Ø·ÙˆØ© 3: ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø±Ø¯ Ø¥Ù„Ù‰ ØµÙˆØª ======
from gtts import gTTS
from IPython.display import Audio

tts = gTTS(text=generated_text, lang='ar')
output_audio_file = "response.mp3"
tts.save(output_audio_file)

Audio(output_audio_file)